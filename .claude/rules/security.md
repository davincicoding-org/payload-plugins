# Security

## Secrets Management

- Never hardcode API keys, tokens, or passwords in source code
- Store all secrets in environment variables
- Add `.env` and `.env.local` files to `.gitignore`
- Never commit secrets to git history; rotate immediately if any were exposed
- Store production secrets in your hosting platform's secret management
- Use separate secrets for each environment (development, staging, production)
- Verify that required secrets are present at startup; fail fast if missing

## Input Validation

- Validate all user input with schemas before processing
- Use a whitelist approach for allowed values, not a blacklist
- Validate file uploads for size, MIME type, and file extension
- Never pass user input directly to queries or system calls without validation
- Ensure error messages do not reveal internal details or sensitive information
- Validate and sanitize URL parameters, query strings, and request headers
- Enforce maximum length limits on all string inputs
- Reject unexpected fields; do not silently pass them through

## SQL Injection Prevention

- Always use parameterized queries or prepared statements
- Never build SQL strings through concatenation with user input
- When using an ORM or query builder, use its parameterization correctly
- When writing raw SQL, use parameter binding placeholders
- Apply the principle of least privilege to database credentials

## Authentication and Authorization

- Store tokens in httpOnly, Secure, SameSite cookies
- Never store tokens or session identifiers in client-side storage accessible to scripts
- Perform authorization checks before every sensitive operation
- Implement role-based access control for protected resources
- Enforce secure session management with proper expiration
- Invalidate sessions on logout and password change
- Use strong, unique session identifiers generated by a cryptographic random source
- Implement account lockout or exponential backoff after repeated failed login attempts

## XSS Prevention

- Sanitize all user-provided HTML before rendering
- Configure Content Security Policy headers to restrict resource origins
- Rely on your framework's automatic output escaping; do not bypass it
- Never render unvalidated dynamic content as raw HTML
- Escape output appropriate to its context (HTML, URL, CSS, JavaScript)
- Avoid inline event handlers and inline scripts

## CSRF Protection

- Include CSRF tokens on all state-changing operations
- Set SameSite attribute to Strict or Lax on all cookies
- Consider double-submit cookie pattern where applicable
- Verify the Origin and Referer headers on sensitive requests

## Rate Limiting

- Apply rate limiting to all public API endpoints
- Use stricter limits on expensive operations such as search, authentication, and file uploads
- Implement both IP-based and user-based rate limiting
- Return appropriate status codes and retry-after headers when limits are exceeded
- Consider progressive penalties for repeated violations

## Sensitive Data Exposure

- Never log passwords, tokens, API keys, or personally identifiable information
- Return generic error messages to users
- Log detailed error information only on the server side
- Never expose stack traces or internal paths to end users
- Redact sensitive fields before logging request or response data
- Mask or truncate sensitive values when partial display is necessary (e.g., last four digits)
- Ensure debug modes and verbose logging are disabled in production

## Dependency Security

- Run regular security audits on project dependencies
- Always commit lock files to version control
- Use automated dependency update tools to stay current
- Establish a regular schedule for reviewing and applying security patches
- Pin dependency versions to avoid unexpected changes from upstream
- Review changelogs and advisories before upgrading major versions

## Transport and Headers

- Enforce HTTPS in all environments
- Configure Content Security Policy headers appropriate to your application
- Set X-Frame-Options to prevent clickjacking
- Enable Strict-Transport-Security with a long max-age
- Restrict CORS to specific allowed origins; never use a wildcard in production
- Set X-Content-Type-Options to nosniff to prevent MIME type sniffing
- Remove server version headers that disclose technology stack details
